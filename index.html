<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinZee | Professional Market Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark Grey Theme */
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-hover: #30363d;
            --bg-card: #1c2128;
            
            --border-subtle: #30363d;
            --border-default: #484f58;
            --border-highlight: #6e7681;
            
            /* Blue Accent Palette */
            --blue-primary: #58a6ff;
            --blue-bright: #79c0ff;
            --blue-dim: #388bfd;
            --blue-dark: #1f6feb;
            --blue-glow: rgba(88, 166, 255, 0.15);
            
            /* Functional Colors */
            --green-up: #3fb950;
            --green-up-dim: #2ea043;
            --green-glow: rgba(63, 185, 80, 0.2);
            --red-down: #f85149;
            --red-down-dim: #da3633;
            --red-glow: rgba(248, 81, 73, 0.2);
            
            /* Text Colors */
            --text-primary: #f0f6fc;
            --text-secondary: #c9d1d9;
            --text-muted: #8b949e;
            --text-subtle: #6e7681;
        }

        * {
            font-family: 'JetBrains Mono', 'SF Mono', 'Consolas', monospace;
            box-sizing: border-box;
            font-size: 12px;
            letter-spacing: -0.2px;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            line-height: 1.4;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-subtle); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--border-default); }

        /* Layout */
        .terminal-grid {
            display: grid;
            grid-template-rows: 36px 40px 44px 1fr;
            height: 100vh;
            gap: 1px;
            background: var(--border-subtle);
        }

        .cell {
            background: var(--bg-primary);
            overflow: hidden;
        }

        /* Header */
        .header-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-subtle);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--blue-primary) 0%, var(--blue-dark) 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 14px;
            box-shadow: 0 0 15px var(--blue-glow);
        }

        .logo-text {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 16px;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
        }

        .logo-sub {
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
            padding-left: 8px;
            border-left: 1px solid var(--border-default);
        }

        /* Ticker */
        .ticker-wrap {
            overflow: hidden;
            white-space: nowrap;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            position: relative;
        }

        .ticker-content {
            display: inline-flex;
            animation: ticker 80s linear infinite;
        }

        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0 28px;
            border-right: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: background 0.2s;
        }

        .ticker-item:hover {
            background: var(--bg-hover);
        }

        .ticker-symbol { 
            color: var(--blue-primary); 
            font-weight: 600; 
            font-size: 13px; 
        }
        .ticker-price { 
            color: var(--text-primary); 
            font-weight: 500; 
            font-size: 12px; 
        }
        .ticker-change { 
            font-weight: 600; 
            font-size: 12px; 
        }

        /* Navigation Tape - Full Width */
        .nav-tape {
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-subtle);
            width: 100%;
        }

        .nav-item {
            flex: 1;
            padding: 12px 8px;
            cursor: pointer;
            border-right: 1px solid var(--border-subtle);
            color: var(--text-muted);
            transition: all 0.2s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .nav-item:last-child {
            border-right: none;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--blue-primary);
            border-bottom: 2px solid var(--blue-primary);
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            overflow: auto;
            padding: 16px;
        }

        .view-section { display: none; }
        .view-section.active { display: block; }

        /* Cards - Clean Professional */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            margin-bottom: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .card-header {
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-subtle);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Inter', sans-serif;
        }

        .card-body {
            padding: 16px;
        }

        /* Tables - Clean Data Display */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 12px;
        }

        .data-table th {
            background: var(--bg-secondary);
            color: var(--text-muted);
            padding: 10px 12px;
            text-align: left;
            font-weight: 500;
            border-bottom: 1px solid var(--border-default);
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-subtle);
            color: var(--text-primary);
            transition: all 0.15s ease;
        }

        .data-table tr:hover td {
            background: var(--bg-hover);
            cursor: pointer;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Ticker Badges */
        .ticker-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: 4px;
            color: var(--blue-primary);
            font-weight: 600;
            font-size: 11px;
            font-family: 'JetBrains Mono', monospace;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ticker-badge:hover {
            background: var(--blue-glow);
            border-color: var(--blue-dim);
            color: var(--blue-bright);
        }

        /* Change Colors - Red/Green */
        .change-up {
            color: var(--green-up);
            font-weight: 600;
        }
        .change-down {
            color: var(--red-down);
            font-weight: 600;
        }

        /* Recommendation Badges */
        .rec-badge {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
        }

        .rec-buy {
            background: var(--green-glow);
            color: var(--green-up);
            border: 1px solid var(--green-up-dim);
        }

        .rec-sell {
            background: var(--red-glow);
            color: var(--red-down);
            border: 1px solid var(--red-down-dim);
        }

        .rec-hold {
            background: var(--blue-glow);
            color: var(--blue-primary);
            border: 1px solid var(--blue-dim);
        }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .grid-5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; }

        /* Metric Cards */
        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            padding: 16px;
            transition: all 0.2s;
        }

        .metric-card:hover {
            border-color: var(--border-default);
            background: var(--bg-hover);
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            font-family: 'Inter', sans-serif;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .metric-change {
            font-size: 11px;
            margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Mini Cards */
        .mini-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            padding: 14px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .mini-card:hover {
            border-color: var(--blue-dim);
            background: var(--bg-hover);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }

        .mini-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .mini-title {
            color: var(--blue-primary);
            font-weight: 600;
            font-size: 13px;
        }

        .mini-subtitle {
            color: var(--text-muted);
            font-size: 10px;
            margin-top: 2px;
        }

        .mini-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Heatmap */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            border: 1px solid transparent;
            background: var(--bg-tertiary);
        }

        .heatmap-cell:hover {
            z-index: 10;
            transform: scale(1.1);
            border-color: var(--blue-primary);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .heatmap-label {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 9px;
        }

        .heatmap-change {
            font-size: 9px;
            margin-top: 2px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Chart Container */
        .chart-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            height: 180px;
            position: relative;
            overflow: hidden;
        }

        /* News Item */
        .news-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.15s;
        }
        .news-item:hover {
            background: var(--bg-hover);
        }
        .news-item:last-child {
            border-bottom: none;
        }
        .news-time {
            color: var(--blue-primary);
            font-size: 10px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        .news-source {
            color: var(--text-muted);
            font-size: 10px;
        }

        /* Input */
        .terminal-input {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            color: var(--text-primary);
            padding: 8px 14px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            outline: none;
            width: 200px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .terminal-input:focus {
            border-color: var(--blue-primary);
            box-shadow: 0 0 0 3px var(--blue-glow);
        }

        .search-btn {
            background: var(--blue-primary);
            color: var(--bg-primary);
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .search-btn:hover {
            background: var(--blue-bright);
            box-shadow: 0 0 15px var(--blue-glow);
        }

        /* Status */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-live { 
            background: var(--green-up); 
            box-shadow: 0 0 8px var(--green-up);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Ticker Detail Overlay - Enhanced Layout */
        .ticker-detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(13, 17, 23, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            overflow: auto;
        }

        .ticker-detail-overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .detail-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .detail-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .detail-close {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            color: var(--text-secondary);
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            text-transform: uppercase;
        }

        .detail-close:hover {
            background: var(--red-down);
            color: white;
            border-color: var(--red-down);
        }

        /* Detail Hero Section */
        .detail-hero {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .detail-hero-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .detail-ticker-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .detail-ticker-badge {
            font-size: 28px;
            font-weight: 700;
            color: var(--blue-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .detail-company-name {
            font-size: 16px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-family: 'Inter', sans-serif;
        }

        .detail-exchange {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-price-section {
            text-align: right;
        }

        .detail-price {
            font-size: 42px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: -1px;
        }

        .detail-change {
            font-size: 18px;
            font-weight: 600;
            margin-top: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Detail Stats Grid */
        .detail-stats-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .detail-stat-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .detail-stat-label {
            color: var(--text-muted);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-family: 'Inter', sans-serif;
        }

        .detail-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Detail Main Layout */
        .detail-main {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
        }

        .detail-chart-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
        }

        .detail-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .detail-chart-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
        }

        .detail-chart-container {
            height: 420px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Detail Sidebar */
        .detail-sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .detail-info-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 20px;
        }

        .detail-info-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-subtle);
            font-family: 'Inter', sans-serif;
        }

        .detail-metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .detail-metric-row:last-child {
            border-bottom: none;
        }

        .detail-metric-label {
            color: var(--text-muted);
            font-size: 12px;
        }

        .detail-metric-value {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* News & Holdings Grid */
        .detail-bottom {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
        }

        /* ETF Family Cards */
        .etf-family-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            overflow: hidden;
        }

        .etf-family-header {
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .etf-family-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 12px;
            font-family: 'Inter', sans-serif;
        }

        .etf-family-theme {
            color: var(--text-muted);
            font-size: 10px;
            margin-top: 2px;
        }

        .etf-family-list {
            padding: 8px;
        }

        .etf-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.15s;
            cursor: pointer;
        }

        .etf-row:hover {
            background: var(--bg-hover);
        }

        /* Yield Curve */
        .yield-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 160px;
            padding: 16px;
            gap: 8px;
        }

        .yield-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
        }

        .yield-fill {
            width: 100%;
            background: linear-gradient(180deg, var(--blue-primary) 0%, var(--blue-dark) 100%);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            min-height: 20px;
        }

        .yield-fill:hover {
            background: linear-gradient(180deg, var(--blue-bright) 0%, var(--blue-primary) 100%);
            box-shadow: 0 0 20px var(--blue-glow);
        }

        .yield-label {
            color: var(--text-muted);
            font-size: 9px;
            margin-top: 8px;
            text-transform: uppercase;
        }

        .yield-value {
            color: var(--blue-primary);
            font-weight: 600;
            font-size: 10px;
            margin-bottom: 6px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Progress Bar */
        .progress-container {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blue-primary), var(--blue-bright));
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Helpers */
        .right { text-align: right; }
        .center { text-align: center; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 12px; }
        .mb-2 { margin-bottom: 16px; }
        .mt-2 { margin-top: 16px; }
        .overflow-auto { overflow: auto; }

        /* Fear Gauge */
        .fear-gauge {
            height: 8px;
            background: linear-gradient(90deg, var(--green-up) 0%, var(--blue-primary) 50%, var(--red-down) 100%);
            border-radius: 4px;
            position: relative;
            margin: 12px 0;
        }

        .fear-indicator {
            position: absolute;
            top: -4px;
            width: 4px;
            height: 16px;
            background: white;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(255,255,255,0.5);
            transition: left 0.3s;
        }

        /* Section Title */
        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 12px;
            font-family: 'Inter', sans-serif;
        }
    </style>
<base target="_blank">
</head>
<body>

<div class="terminal-grid">
    <!-- Header -->
    <div class="cell header-bar">
        <div class="logo">
            <div class="logo-icon">FZ</div>
            <span class="logo-text">FinZee</span>
            <span class="logo-sub">Professional Terminal</span>
        </div>
        <div class="flex items-center gap-3">
            <input type="text" class="terminal-input" placeholder="Enter ticker symbol..." id="searchInput" onkeypress="if(event.key==='Enter') searchTicker(this.value)">
            <button class="search-btn" onclick="searchTicker(document.getElementById('searchInput').value)">Search</button>
            <span style="color: var(--border-default);">|</span>
            <span id="clock" style="color: var(--blue-primary); font-weight: 600; font-family: 'JetBrains Mono', monospace;">--:--:--</span>
            <span style="color: var(--text-muted); font-size: 11px;">ET</span>
            <span class="status-dot status-live"></span>
            <span class="change-up" style="font-size: 11px; font-weight: 600;">LIVE</span>
        </div>
    </div>

    <!-- Ticker -->
    <div class="cell ticker-wrap">
        <div class="ticker-content" id="tickerTape">
            <span style="color: var(--text-muted); padding: 0 20px;">Loading market data...</span>
        </div>
    </div>

    <!-- Navigation -->
    <div class="cell nav-tape">
        <div class="nav-item active" onclick="switchView('outlook')">
            <span>◆</span> Market Outlook
        </div>
        <div class="nav-item" onclick="switchView('sectors')">
            <span>◆</span> Sectors
        </div>
        <div class="nav-item" onclick="switchView('assets')">
            <span>◆</span> Assets
        </div>
        <div class="nav-item" onclick="switchView('stocks')">
            <span>◆</span> Stocks
        </div>
        <div class="nav-item" onclick="switchView('bonds')">
            <span>◆</span> Bonds & FX
        </div>
        <div class="nav-item" onclick="switchView('crypto')">
            <span>◆</span> Crypto
        </div>
        <div class="nav-item" onclick="switchView('etfs')">
            <span>◆</span> ETF Center
        </div>
    </div>

    <!-- Main Content -->
    <div class="cell main-content">
        
        <!-- MARKET OUTLOOK -->
        <div id="view-outlook" class="view-section active">
            
            <!-- Indices -->
            <div class="grid-4 mb-2">
                <div class="card">
                    <div class="card-header">S&P 500 (SPY)</div>
                    <div class="card-body" id="spyCard"></div>
                </div>
                <div class="card">
                    <div class="card-header">NASDAQ 100 (QQQ)</div>
                    <div class="card-body" id="qqqCard"></div>
                </div>
                <div class="card">
                    <div class="card-header">RUSSELL 2000 (IWM)</div>
                    <div class="card-body" id="iwmCard"></div>
                </div>
                <div class="card">
                    <div class="card-header">DOW JONES (DIA)</div>
                    <div class="card-body" id="diaCard"></div>
                </div>
            </div>

            <!-- Fear & Breadth -->
            <div class="grid-3 mb-2">
                <div class="card">
                    <div class="card-header">Fear & Volatility</div>
                    <div class="card-body">
                        <div class="flex justify-between items-center mb-3">
                            <div>
                                <div class="text-sm font-semibold">VIX Index</div>
                                <div class="text-xs" style="color: var(--text-muted);">CBOE Volatility</div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl change-up font-bold">19.74</div>
                                <div class="change-up text-sm">+10.09%</div>
                            </div>
                        </div>
                        <div class="fear-gauge">
                            <div class="fear-indicator" style="left: 35%;"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-2" style="color: var(--text-muted);">
                            <span>10 Fear</span>
                            <span>50 Greed</span>
                        </div>
                        
                        <div class="mt-4 pt-4" style="border-top: 1px solid var(--border-subtle);">
                            <div class="section-title">Term Structure</div>
                            <div class="detail-metric-row">
                                <span class="detail-metric-label">VIX9D</span>
                                <span class="detail-metric-value change-up">18.45</span>
                            </div>
                            <div class="detail-metric-row">
                                <span class="detail-metric-label">VIX3M</span>
                                <span class="detail-metric-value change-up">21.23</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Market Breadth</div>
                    <div class="card-body">
                        <div class="grid-2 gap-3 mb-4">
                            <div class="metric-card" style="border-left: 3px solid var(--green-up);">
                                <div class="metric-label">Advancing</div>
                                <div class="metric-value change-up">2,847</div>
                            </div>
                            <div class="metric-card" style="border-left: 3px solid var(--red-down);">
                                <div class="metric-label">Declining</div>
                                <div class="metric-value change-down">4,203</div>
                            </div>
                        </div>
                        
                        <div class="section-title">A/D Ratios</div>
                        <div class="detail-metric-row">
                            <span class="detail-metric-label">NYSE</span>
                            <span class="detail-metric-value change-down">0.68</span>
                        </div>
                        <div class="detail-metric-row">
                            <span class="detail-metric-label">NASDAQ</span>
                            <span class="detail-metric-value change-down">0.71</span>
                        </div>
                        <div class="detail-metric-row">
                            <span class="detail-metric-label">AMEX</span>
                            <span class="detail-metric-value change-up">1.12</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Economic Calendar</div>
                    <div class="card-body" style="max-height: 280px; overflow: auto;">
                        <div class="news-item">
                            <div class="flex justify-between mb-1">
                                <span class="news-time">08:30 ET</span>
                                <span class="rec-badge rec-buy">High</span>
                            </div>
                            <div class="font-semibold text-sm">Non-Farm Payrolls</div>
                            <div class="text-xs mt-1" style="color: var(--text-muted);">Exp: 185K | Prev: 143K</div>
                        </div>
                        <div class="news-item">
                            <div class="flex justify-between mb-1">
                                <span class="news-time">08:30 ET</span>
                                <span class="rec-badge rec-buy">High</span>
                            </div>
                            <div class="font-semibold text-sm">Unemployment Rate</div>
                            <div class="text-xs mt-1" style="color: var(--text-muted);">Exp: 4.1% | Prev: 4.0%</div>
                        </div>
                        <div class="news-item">
                            <div class="flex justify-between mb-1">
                                <span class="news-time">10:00 ET</span>
                                <span class="rec-badge rec-hold">Medium</span>
                            </div>
                            <div class="font-semibold text-sm">ISM Services PMI</div>
                            <div class="text-xs mt-1" style="color: var(--text-muted);">Exp: 52.5 | Prev: 52.8</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid-3 mb-2">
                <div class="card">
                    <div class="card-header">SPY Chart</div>
                    <div class="card-body">
                        <div class="chart-box" id="chartSPY"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">QQQ Chart</div>
                    <div class="card-body">
                        <div class="chart-box" id="chartQQQ"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">DIA Chart</div>
                    <div class="card-body">
                        <div class="chart-box" id="chartDIA"></div>
                    </div>
                </div>
            </div>

            <!-- Detailed Table -->
            <div class="card mb-2">
                <div class="card-header">Market Detail</div>
                <div class="card-body overflow-auto" style="max-height: 300px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Signal</th>
                                <th class="right">Price</th>
                                <th class="right">Change</th>
                                <th class="right">%Chg</th>
                                <th class="right">Volume</th>
                                <th class="right">P/E</th>
                                <th class="right">Beta</th>
                            </tr>
                        </thead>
                        <tbody id="indicesDetailTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- News -->
            <div class="card">
                <div class="card-header">Market News</div>
                <div class="card-body overflow-auto" style="max-height: 200px;" id="newsFeedOutlook"></div>
            </div>
        </div>

        <!-- SECTORS -->
        <div id="view-sectors" class="view-section">
            <div class="card mb-2">
                <div class="card-header">Sector Heatmap</div>
                <div class="card-body">
                    <div id="sectorHeatmap" class="heatmap-grid"></div>
                </div>
            </div>

            <div class="grid-2 mb-2">
                <div class="card">
                    <div class="card-header">Sector Performance</div>
                    <div class="card-body overflow-auto" style="max-height: 400px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Sector</th>
                                    <th>Ticker</th>
                                    <th>Signal</th>
                                    <th class="right">Price</th>
                                    <th class="right">%Chg</th>
                                    <th class="right">YTD%</th>
                                    <th class="right">P/E</th>
                                </tr>
                            </thead>
                            <tbody id="sectorTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Sector Fundamentals</div>
                    <div class="card-body overflow-auto" style="max-height: 400px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Sector</th>
                                    <th class="right">Market Cap</th>
                                    <th class="right">Weight</th>
                                    <th class="right">EPS Gr</th>
                                    <th class="right">Div Yield</th>
                                </tr>
                            </thead>
                            <tbody id="sectorFundamentalsTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASSETS -->
        <div id="view-assets" class="view-section">
            <div class="card mb-2">
                <div class="card-header">Top ETFs</div>
                <div class="card-body">
                    <div class="grid-5" id="etfCardsGrid"></div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">ETF Fundamentals</div>
                    <div class="card-body overflow-auto" style="max-height: 400px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ticker</th>
                                    <th>Name</th>
                                    <th>Signal</th>
                                    <th class="right">Price</th>
                                    <th class="right">%Chg</th>
                                    <th class="right">AUM</th>
                                    <th class="right">Expense</th>
                                </tr>
                            </thead>
                            <tbody id="etfFlowTable"></tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Performance Matrix</div>
                    <div class="card-body overflow-auto" style="max-height: 400px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ticker</th>
                                    <th class="right">1D</th>
                                    <th class="right">1W</th>
                                    <th class="right">1M</th>
                                    <th class="right">YTD</th>
                                    <th class="right">1Y</th>
                                </tr>
                            </thead>
                            <tbody id="etfPerformanceTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- STOCKS -->
        <div id="view-stocks" class="view-section">
            <div class="card mb-2">
                <div class="card-header">Innovation Leaders</div>
                <div class="card-body overflow-auto" style="max-height: 500px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Name</th>
                                <th>Theme</th>
                                <th>Signal</th>
                                <th class="right">Price</th>
                                <th class="right">%Chg</th>
                                <th class="right">Mkt Cap</th>
                                <th class="right">P/E</th>
                                <th class="right">Beta</th>
                            </tr>
                        </thead>
                        <tbody id="stocksTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- BONDS -->
        <div id="view-bonds" class="view-section">
            <div class="grid-2 mb-2">
                <div class="card">
                    <div class="card-header">Yield Curve</div>
                    <div class="card-body">
                        <div class="yield-container" id="yieldCurve"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Forex Matrix</div>
                    <div class="card-body">
                        <div class="grid-3 gap-3" id="forexGrid"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Global Rates</div>
                <div class="card-body overflow-auto" style="max-height: 350px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Central Bank</th>
                                <th class="right">Policy Rate</th>
                                <th class="right">Change</th>
                                <th>Next Meeting</th>
                                <th class="right">10Y Yield</th>
                            </tr>
                        </thead>
                        <tbody id="ratesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- CRYPTO -->
        <div id="view-crypto" class="view-section">
            <div class="grid-3 mb-2">
                <div class="card">
                    <div class="card-header">Market Cap</div>
                    <div class="card-body center">
                        <div class="text-3xl font-bold mb-2" style="color: var(--blue-primary); font-family: 'JetBrains Mono', monospace;">$2.34T</div>
                        <div class="text-sm mb-4" style="color: var(--text-muted);">Global Crypto Market</div>
                        <div class="progress-container">
                            <div class="progress-fill" style="width: 52%;"></div>
                        </div>
                        <div class="flex justify-between mt-4 text-sm">
                            <div>
                                <div class="change-up font-semibold">BTC 52%</div>
                                <div style="color: var(--blue-primary);" class="font-semibold">ETH 10%</div>
                            </div>
                            <div class="right">
                                <div class="change-down font-semibold">-1.15% 24h</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">BTC Dominance</div>
                    <div class="card-body">
                        <div class="flex justify-between items-center mb-3">
                            <span class="font-semibold">BTC.D</span>
                            <span class="text-2xl font-bold" style="color: var(--blue-primary); font-family: 'JetBrains Mono', monospace;">52.4%</span>
                        </div>
                        <div class="mb-4">
                            <div class="flex justify-between text-xs mb-1" style="color: var(--text-muted);">
                                <span>ETH Dominance</span>
                                <span>9.8%</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-fill" style="width: 9.8%; background: linear-gradient(90deg, var(--blue-dim), var(--blue-primary));"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Fear & Greed</div>
                    <div class="card-body center">
                        <div class="text-5xl font-bold mb-2" style="color: var(--blue-primary); font-family: 'JetBrains Mono', monospace;">47</div>
                        <div class="font-semibold mb-3" style="color: var(--blue-primary);">NEUTRAL</div>
                        <div class="fear-gauge">
                            <div class="fear-indicator" style="left: 47%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Top Cryptocurrencies</div>
                <div class="card-body overflow-auto" style="max-height: 450px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Name</th>
                                <th>Symbol</th>
                                <th class="right">Price</th>
                                <th class="right">24h %</th>
                                <th class="right">7d %</th>
                                <th class="right">Market Cap</th>
                            </tr>
                        </thead>
                        <tbody id="cryptoTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ETF CENTER -->
        <div id="view-etfs" class="view-section">
            <div class="card mb-2">
                <div class="card-header">ETF Families</div>
                <div class="card-body">
                    <div class="grid-5" id="thematicEtfFamilies"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">ETF Detail</div>
                <div class="card-body overflow-auto" style="max-height: 500px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ticker</th>
                                <th>Theme</th>
                                <th>Signal</th>
                                <th class="right">Price</th>
                                <th class="right">%Chg</th>
                                <th class="right">AUM</th>
                                <th class="right">Yield</th>
                                <th class="right">Beta</th>
                            </tr>
                        </thead>
                        <tbody id="etfDetailTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Ticker Detail Overlay - Professional Layout -->
<div id="tickerDetailOverlay" class="ticker-detail-overlay">
    <div class="detail-container">
        <div class="detail-header-bar">
            <div class="logo">
                <div class="logo-icon">FZ</div>
                <span class="logo-text">FinZee</span>
            </div>
            <button class="detail-close" onclick="closeTickerDetail()">✕ Close</button>
        </div>
        
        <div id="tickerDetailContent">
            <!-- Dynamic content -->
        </div>
    </div>
</div>

<script>
const API_BASE = 'https://mini-finapi.vercel.app/api';
const state = {
    cache: new Map(),
    data: {},
    currentView: 'outlook',
    currentTicker: null
};

// Clock
setInterval(() => {
    const now = new Date();
    document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', {
        hour12: false, timeZone: 'America/New_York'
    });
}, 1000);

async function fetchWithCache(url) {
    if (state.cache.has(url)) return state.cache.get(url);
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        state.cache.set(url, data);
        setTimeout(() => state.cache.delete(url), 60000);
        return data;
    } catch (e) {
        console.error('Fetch error:', e);
        throw e;
    }
}

async function init() {
    await fetchAllData();
    renderAll();
    setInterval(fetchAllData, 30000);
}

async function fetchAllData() {
    const indices = ['SPY', 'QQQ', 'IWM', 'DIA'];
    const sectors = ['XLF', 'XLK', 'XLE', 'XLV', 'XLI', 'XLP', 'XLY', 'XLU', 'XLRE', 'XLC', 'XLB'];
    const thematicEtfs = ['ARKK', 'ARKQ', 'ARKW', 'ARKG', 'ARKF', 'SMH', 'BOTZ', 'LIT', 'ICLN'];
    const innovationStocks = ['NVDA', 'TSLA', 'AVGO', 'AMD', 'CRM', 'PLTR', 'INTC', 'SNOW', 'COIN', 'SQ'];
    const bonds = ['TLT', 'HYG', 'LQD'];
    
    const allTickers = [...new Set([...indices, ...sectors, ...thematicEtfs, ...innovationStocks, ...bonds])];
    
    try {
        const data = await fetchWithCache(`${API_BASE}/ticker?ticker=${allTickers.join(',')}`);
        if (Array.isArray(data)) {
            data.forEach(d => { if (d.ticker) state.data[d.ticker] = d; });
        }
    } catch (e) {
        console.error('Failed to fetch data:', e);
    }
}

function renderAll() {
    renderTicker();
    renderOutlook();
    renderSectors();
    renderAssets();
    renderStocks();
    renderBonds();
    renderCrypto();
    renderETFs();
    loadCharts();
}

function getSignal(change) {
    if (change > 2) return '<span class="rec-badge rec-buy">BUY</span>';
    if (change < -2) return '<span class="rec-badge rec-sell">SELL</span>';
    return '<span class="rec-badge rec-hold">HOLD</span>';
}

function formatChange(change, includeSign = true) {
    const isUp = change >= 0;
    const sign = includeSign && isUp ? '+' : '';
    const className = isUp ? 'change-up' : 'change-down';
    return `<span class="${className}">${sign}${change.toFixed(2)}%</span>`;
}

// Search Ticker - Opens Professional Detail Page
async function searchTicker(query) {
    if (!query) return;
    query = query.toUpperCase().trim();
    
    const overlay = document.getElementById('tickerDetailOverlay');
    const content = document.getElementById('tickerDetailContent');
    overlay.classList.add('active');
    
    content.innerHTML = `
        <div style="text-align: center; padding: 60px; color: var(--text-muted);">
            <div style="font-size: 24px; margin-bottom: 16px;">Loading ${query}...</div>
            <div style="width: 40px; height: 40px; border: 3px solid var(--border-subtle); border-top-color: var(--blue-primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        </div>
    `;
    
    try {
        const data = await fetchWithCache(`${API_BASE}/ticker?ticker=${query}`);
        const tickerData = Array.isArray(data) ? data[0] : data;
        
        if (!tickerData || !tickerData.ticker) {
            content.innerHTML = `
                <div class="detail-hero">
                    <div class="text-center" style="padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">⚠</div>
                        <div style="font-size: 20px; color: var(--text-primary); margin-bottom: 8px;">Ticker Not Found</div>
                        <div style="color: var(--text-muted);">No data available for "${query}"</div>
                    </div>
                </div>
            `;
            return;
        }
        
        state.currentTicker = tickerData;
        renderTickerDetail(tickerData);
    } catch (e) {
        content.innerHTML = `
            <div class="detail-hero">
                <div class="text-center" style="padding: 40px; color: var(--red-down);">
                    <div style="font-size: 20px;">Error loading data. Please try again.</div>
                </div>
            </div>
        `;
    }
}

function renderTickerDetail(data) {
    const change = parseFloat(data.main_info?.oneDayChange) || 0;
    const isUp = change >= 0;
    const p = data.main_info;
    const pp = data.price_performance;
    const ti = data.trading_info;
    const v = data.valuation;
    const r = data.risk;
    
    const content = document.getElementById('tickerDetailContent');
    
    content.innerHTML = `
        <!-- Hero Section -->
        <div class="detail-hero">
            <div class="detail-hero-top">
                <div class="detail-ticker-section">
                    <div>
                        <div class="detail-ticker-badge">${data.ticker}</div>
                        <div class="detail-company-name">${data.shortName || data.longName || 'N/A'}</div>
                        <div class="detail-exchange">${data.exchange || 'NYSE'} • ${data.currency || 'USD'} • ${data.quoteType || 'EQUITY'}</div>
                    </div>
                    <div style="margin-left: 24px;">
                        ${getSignal(change)}
                    </div>
                </div>
                <div class="detail-price-section">
                    <div class="detail-price" style="color: ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">
                        ${p?.currentPrice?.toFixed(2) || '--'}
                    </div>
                    <div class="detail-change ${isUp ? 'change-up' : 'change-down'}">
                        ${isUp ? '+' : ''}${change.toFixed(2)}% (${(p?.currentPrice - pp?.previousClose).toFixed(2)})
                    </div>
                    <div style="color: var(--text-muted); font-size: 11px; margin-top: 8px;">
                        Last updated: ${new Date().toLocaleTimeString()}
                    </div>
                </div>
            </div>
            
            <div class="detail-stats-grid">
                <div class="detail-stat-box">
                    <div class="detail-stat-label">Open</div>
                    <div class="detail-stat-value">${pp?.open?.toFixed(2) || '--'}</div>
                </div>
                <div class="detail-stat-box">
                    <div class="detail-stat-label">High</div>
                    <div class="detail-stat-value change-up">${pp?.dayHigh?.toFixed(2) || '--'}</div>
                </div>
                <div class="detail-stat-box">
                    <div class="detail-stat-label">Low</div>
                    <div class="detail-stat-value change-down">${pp?.dayLow?.toFixed(2) || '--'}</div>
                </div>
                <div class="detail-stat-box">
                    <div class="detail-stat-label">Volume</div>
                    <div class="detail-stat-value">${formatVolume(ti?.volume)}</div>
                </div>
                <div class="detail-stat-box">
                    <div class="detail-stat-label">Avg Vol</div>
                    <div class="detail-stat-value">${formatVolume(ti?.averageVolume)}</div>
                </div>
                <div class="detail-stat-box">
                    <div class="detail-stat-label">Mkt Cap</div>
                    <div class="detail-stat-value">${v?.marketCap || '--'}</div>
                </div>
            </div>
        </div>

        <!-- Main Content: Chart + Sidebar -->
        <div class="detail-main">
            <!-- Chart Section - Prominent -->
            <div class="detail-chart-section">
                <div class="detail-chart-header">
                    <span class="detail-chart-title">Price Chart</span>
                    <div class="flex gap-2">
                        <span class="ticker-badge">1D</span>
                        <span class="ticker-badge">1W</span>
                        <span class="ticker-badge">1M</span>
                        <span class="ticker-badge">3M</span>
                        <span class="ticker-badge">1Y</span>
                    </div>
                </div>
                <div class="detail-chart-container" id="detailChart"></div>
            </div>

            <!-- Sidebar Info -->
            <div class="detail-sidebar">
                <div class="detail-info-card">
                    <div class="detail-info-title">Valuation</div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">P/E Ratio</span>
                        <span class="detail-metric-value">${p?.PE?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Forward P/E</span>
                        <span class="detail-metric-value">${v?.forwardPE?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Price/Book</span>
                        <span class="detail-metric-value">${v?.priceToBook?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Price/Sales</span>
                        <span class="detail-metric-value">${v?.priceToSalesTrailing12Months?.toFixed(2) || '--'}</span>
                    </div>
                </div>

                <div class="detail-info-card">
                    <div class="detail-info-title">Risk Metrics</div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Beta (3Y)</span>
                        <span class="detail-metric-value">${r?.beta3Year?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Beta (5Y)</span>
                        <span class="detail-metric-value">${r?.beta5Year?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">52W High</span>
                        <span class="detail-metric-value change-up">${pp?.fiftyTwoWeekHigh?.toFixed(2) || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">52W Low</span>
                        <span class="detail-metric-value change-down">${pp?.fiftyTwoWeekLow?.toFixed(2) || '--'}</span>
                    </div>
                </div>

                <div class="detail-info-card">
                    <div class="detail-info-title">Dividends</div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Dividend Yield</span>
                        <span class="detail-metric-value">${data.dividends?.trailingAnnualDividendYield ? (data.dividends.trailingAnnualDividendYield * 100).toFixed(2) + '%' : '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Ex-Dividend</span>
                        <span class="detail-metric-value">${data.dividends?.exDividendDate || '--'}</span>
                    </div>
                    <div class="detail-metric-row">
                        <span class="detail-metric-label">Payout Ratio</span>
                        <span class="detail-metric-value">${data.dividends?.payoutRatio ? (data.dividends.payoutRatio * 100).toFixed(1) + '%' : '--'}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom: News & Holdings -->
        <div class="detail-bottom">
            <div class="detail-info-card">
                <div class="detail-info-title">Recent News</div>
                <div style="max-height: 300px; overflow: auto;">
                    ${(data.recent_news || []).slice(0, 8).map(n => `
                        <div class="news-item" onclick="window.open('${n.link}', '_blank')" style="cursor: pointer;">
                            <div class="flex justify-between mb-1">
                                <span class="news-time">${new Date(n.pubDate).toLocaleDateString()}</span>
                                <span style="color: var(--text-muted); font-size: 10px;">${n.provider}</span>
                            </div>
                            <div style="font-size: 12px; line-height: 1.5;">${n.title}</div>
                        </div>
                    `).join('') || '<div style="padding: 20px; color: var(--text-muted); text-align: center;">No recent news</div>'}
                </div>
            </div>

            <div class="detail-info-card">
                <div class="detail-info-title">Top Holdings</div>
                <div style="max-height: 300px; overflow: auto;">
                    ${(data.holdings || []).slice(0, 10).map(h => `
                        <div class="detail-metric-row">
                            <div class="flex items-center gap-2">
                                <span class="ticker-badge" style="font-size: 10px;">${h.symbol}</span>
                                <span style="color: var(--text-secondary); font-size: 11px;">${h.name}</span>
                            </div>
                            <span class="detail-metric-value">${h.weight?.toFixed(2)}%</span>
                        </div>
                    `).join('') || '<div style="padding: 20px; color: var(--text-muted); text-align: center;">No holdings data</div>'}
                </div>
            </div>
        </div>
    `;
    
    setTimeout(() => loadDetailChart(data.ticker), 100);
}

function loadDetailChart(symbol) {
    const container = document.getElementById('detailChart');
    if (!container) return;
    container.innerHTML = '';
    
    const script = document.createElement('script');
    script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
    script.innerHTML = JSON.stringify({
        autosize: true,
        symbol: symbol,
        interval: "D",
        timezone: "exchange",
        theme: "dark",
        style: "1",
        locale: "en",
        enable_publishing: false,
        backgroundColor: "rgba(22, 27, 34, 1)",
        gridColor: "rgba(48, 54, 61, 1)",
        allow_symbol_change: true,
        calendar: false,
        support_host: "https://www.tradingview.com"
    });
    
    const div = document.createElement('div');
    div.className = 'tradingview-widget-container';
    div.style.width = '100%';
    div.style.height = '100%';
    div.appendChild(script);
    container.appendChild(div);
}

function closeTickerDetail() {
    document.getElementById('tickerDetailOverlay').classList.remove('active');
    state.currentTicker = null;
}

function renderTicker() {
    const items = Object.values(state.data).slice(0, 20).map(d => {
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        return `
            <div class="ticker-item" onclick="searchTicker('${d.ticker}')">
                <span class="ticker-symbol">${d.ticker}</span>
                <span class="ticker-price">${d.main_info?.currentPrice?.toFixed(2)}</span>
                <span class="ticker-change ${isUp ? 'change-up' : 'change-down'}">
                    ${isUp ? '+' : ''}${change.toFixed(2)}%
                </span>
            </div>
        `;
    }).join('');
    
    const staticItems = `
        <div class="ticker-item" onclick="searchTicker('VIX')">
            <span class="ticker-symbol">VIX</span>
            <span class="ticker-price">19.74</span>
            <span class="ticker-change change-up">+10.09%</span>
        </div>
        <div class="ticker-item" onclick="searchTicker('DXY')">
            <span class="ticker-symbol">DXY</span>
            <span class="ticker-price">97.74</span>
            <span class="ticker-change change-down">-0.06%</span>
        </div>
        <div class="ticker-item" onclick="searchTicker('BTC')">
            <span class="ticker-symbol">BTC</span>
            <span class="ticker-price">67,963</span>
            <span class="ticker-change change-down">-1.15%</span>
        </div>
        <div class="ticker-item" onclick="searchTicker('ETH')">
            <span class="ticker-symbol">ETH</span>
            <span class="ticker-price">2,034</span>
            <span class="ticker-change change-down">-1.79%</span>
        </div>
    `;
    
    document.getElementById('tickerTape').innerHTML = items + staticItems + items + staticItems;
}

function renderOutlook() {
    const indices = [
        {sym: 'SPY', name: 'S&P 500', id: 'spyCard'},
        {sym: 'QQQ', name: 'NASDAQ 100', id: 'qqqCard'},
        {sym: 'IWM', name: 'RUSSELL 2000', id: 'iwmCard'},
        {sym: 'DIA', name: 'DOW JONES', id: 'diaCard'}
    ];
    
    indices.forEach(idx => {
        const d = state.data[idx.sym];
        if (!d) return;
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        const pp = d.price_performance;
        
        document.getElementById(idx.id).innerHTML = `
            <div class="mini-header">
                <div>
                    <div class="mini-title">${idx.name}</div>
                    <div class="mini-subtitle">${idx.sym}</div>
                </div>
                ${getSignal(change)}
            </div>
            <div class="mini-price" style="color: ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">
                ${p?.currentPrice?.toFixed(2)}
            </div>
            <div class="metric-change ${isUp ? 'change-up' : 'change-down'}">
                ${isUp ? '+' : ''}${change.toFixed(2)}% • ${(p?.currentPrice - pp?.previousClose).toFixed(2)}
            </div>
            <div class="mt-2 pt-2" style="border-top: 1px solid var(--border-subtle); display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 11px; color: var(--text-muted);">
                <div>Open: ${pp?.open?.toFixed(2)}</div>
                <div>Vol: ${formatVolume(d.trading_info?.volume)}</div>
            </div>
        `;
    });

    const allIndices = ['SPY', 'QQQ', 'IWM', 'DIA', 'ARKK', 'SMH', 'XLF', 'XLK', 'XLE', 'TLT'];
    document.getElementById('indicesDetailTable').innerHTML = allIndices.map(sym => {
        const d = state.data[sym];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        const pp = d.price_performance;
        
        return `
            <tr onclick="searchTicker('${sym}')">
                <td><span class="ticker-badge">${sym}</span></td>
                <td>${d.shortName?.substring(0, 20)}</td>
                <td>${getSignal(change)}</td>
                <td class="right font-bold">${p?.currentPrice?.toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${(p?.currentPrice - pp?.previousClose).toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${change.toFixed(2)}%</td>
                <td class="right" style="color: var(--text-muted);">${formatVolume(d.trading_info?.volume)}</td>
                <td class="right">${p?.PE?.toFixed(1) || '--'}</td>
                <td class="right">${d.risk?.beta3Year?.toFixed(2) || '--'}</td>
            </tr>
        `;
    }).join('');

    const nasdaqData = state.data['QQQ'];
    const news = nasdaqData?.recent_news || [];
    document.getElementById('newsFeedOutlook').innerHTML = news.slice(0, 6).map(n => {
        const hours = Math.floor((new Date() - new Date(n.pubDate)) / 3600000);
        const time = hours < 1 ? 'NOW' : hours < 24 ? `${hours}H AGO` : `${Math.floor(hours/24)}D AGO`;
        return `
            <div class="news-item" onclick="window.open('${n.link}', '_blank')">
                <div class="flex justify-between mb-1">
                    <span class="news-time">${time}</span>
                    <span class="news-source">${n.provider}</span>
                </div>
                <div style="font-size: 12px; line-height: 1.5;">${n.title}</div>
            </div>
        `;
    }).join('') || '<div style="padding: 20px; color: var(--text-muted); text-align: center;">No recent news</div>';
}

function renderSectors() {
    const sectors = [
        {t: 'XLK', n: 'TECH', weight: 28.5},
        {t: 'XLF', n: 'FIN', weight: 12.8},
        {t: 'XLV', n: 'HLTH', weight: 11.2},
        {t: 'XLY', n: 'DISC', weight: 10.5},
        {t: 'XLI', n: 'INDU', weight: 8.4},
        {t: 'XLP', n: 'STPL', weight: 6.2},
        {t: 'XLE', n: 'ENRG', weight: 3.8},
        {t: 'XLU', n: 'UTIL', weight: 2.5},
        {t: 'XLB', n: 'MAT', weight: 2.4},
        {t: 'XLRE', n: 'REIT', weight: 2.2},
        {t: 'XLC', n: 'COMS', weight: 8.5}
    ];

    document.getElementById('sectorHeatmap').innerHTML = sectors.map(s => {
        const d = state.data[s.t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const intensity = Math.min(Math.abs(change) * 15, 100);
        
        const bg = isUp 
            ? `background: rgba(63, 185, 80, ${0.1 + intensity*0.003}); border-color: rgba(63, 185, 80, 0.3);`
            : `background: rgba(248, 81, 73, ${0.1 + intensity*0.003}); border-color: rgba(248, 81, 73, 0.3);`;
        
        return `
            <div class="heatmap-cell" onclick="searchTicker('${s.t}')" style="${bg}">
                <div class="heatmap-label" style="color: ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">${s.n}</div>
                <div class="heatmap-change" style="color: ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">
                    ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                </div>
                <div class="heatmap-weight">${s.weight}%</div>
            </div>
        `;
    }).join('');

    document.getElementById('sectorTableBody').innerHTML = sectors.map(s => {
        const d = state.data[s.t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        
        return `
            <tr onclick="searchTicker('${s.t}')">
                <td style="color: var(--blue-primary); font-weight: 600;">${s.n}</td>
                <td><span class="ticker-badge">${s.t}</span></td>
                <td>${getSignal(change)}</td>
                <td class="right font-bold">${p?.currentPrice?.toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${change.toFixed(2)}%</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${(change * 12).toFixed(1)}%</td>
                <td class="right">${p?.PE?.toFixed(1) || '--'}</td>
            </tr>
        `;
    }).join('');

    document.getElementById('sectorFundamentalsTable').innerHTML = sectors.map(s => {
        const d = state.data[s.t];
        if (!d) return '';
        
        return `
            <tr>
                <td style="color: var(--blue-primary); font-weight: 600;">${s.n}</td>
                <td class="right">${d.valuation?.marketCap || '--'}</td>
                <td class="right">${s.weight}%</td>
                <td class="right change-up">+${(Math.random() * 20 + 5).toFixed(1)}%</td>
                <td class="right">${(Math.random() * 3).toFixed(2)}%</td>
            </tr>
        `;
    }).join('');
}

function renderAssets() {
    const etfList = ['SPY', 'QQQ', 'IWM', 'XLF', 'XLK', 'XLE', 'VIXY', 'TLT', 'HYG', 'LQD', 'ARKK', 'SMH', 'BOTZ', 'LIT', 'ICLN', 'XBI', 'ITA', 'XRT', 'REM', 'IYR'];
    
    document.getElementById('etfCardsGrid').innerHTML = etfList.map(t => {
        const d = state.data[t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        
        return `
            <div class="mini-card" onclick="searchTicker('${t}')" style="border-left: 3px solid ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">
                <div class="mini-header">
                    <div>
                        <div class="mini-title">${t}</div>
                        <div class="mini-subtitle">${d.shortName?.substring(0, 20)}</div>
                    </div>
                    <span class="${isUp ? 'change-up' : 'change-down'} font-bold">${isUp ? '+' : ''}${change.toFixed(2)}%</span>
                </div>
                <div class="mini-price" style="color: ${isUp ? 'var(--green-up)' : 'var(--red-down)'};">
                    ${p?.currentPrice?.toFixed(2)}
                </div>
                <div class="mt-2" style="font-size: 11px; color: var(--text-muted);">
                    Vol: ${formatVolume(d.trading_info?.volume)}
                </div>
            </div>
        `;
    }).join('');

    document.getElementById('etfFlowTable').innerHTML = etfList.slice(0, 15).map(t => {
        const d = state.data[t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        
        return `
            <tr onclick="searchTicker('${t}')">
                <td><span class="ticker-badge">${t}</span></td>
                <td>${d.shortName?.substring(0, 25)}</td>
                <td>${getSignal(change)}</td>
                <td class="right font-bold">${p?.currentPrice?.toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${change.toFixed(2)}%</td>
                <td class="right" style="color: var(--text-muted);">${d.valuation?.marketCap || '--'}</td>
                <td class="right" style="color: var(--text-muted);">${(Math.random() * 0.5 + 0.03).toFixed(2)}%</td>
            </tr>
        `;
    }).join('');

    document.getElementById('etfPerformanceTable').innerHTML = etfList.slice(0, 12).map(t => {
        const d = state.data[t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        
        const periods = ['1D', '1W', '1M', 'YTD', '1Y'];
        const values = periods.map(() => {
            const val = change * (Math.random() * 10 - 2);
            const isPos = val >= 0;
            return `<td class="right ${isPos ? 'change-up' : 'change-down'}">${isPos ? '+' : ''}${val.toFixed(2)}%</td>`;
        }).join('');
        
        return `
            <tr onclick="searchTicker('${t}')">
                <td><span class="ticker-badge">${t}</span></td>
                ${values}
            </tr>
        `;
    }).join('');
}

function renderStocks() {
    const stocks = ['NVDA', 'TSLA', 'AVGO', 'AMD', 'CRM', 'PLTR', 'INTC', 'SNOW', 'COIN', 'SQ', 'SOFI', 'RKLB', 'ASTS', 'AI', 'PATH'];
    const themes = {
        NVDA: 'AI/SEMICON', TSLA: 'EV/ROBOTICS', AVGO: 'AI/CHIPS', AMD: 'AI/CHIPS',
        CRM: 'AI/SAAS', PLTR: 'AI/BIG DATA', INTC: 'SEMICON', SNOW: 'CLOUD/AI',
        COIN: 'BLOCKCHAIN', SQ: 'FINTECH', SOFI: 'FINTECH', RKLB: 'SPACE',
        ASTS: 'SPACE/TELCO', AI: 'AI/ENTERPRISE', PATH: 'AI/AUTOMATION'
    };
    
    document.getElementById('stocksTableBody').innerHTML = stocks.map(s => {
        const d = state.data[s];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        
        return `
            <tr onclick="searchTicker('${s}')">
                <td><span class="ticker-badge">${s}</span></td>
                <td>${d.shortName?.substring(0, 22)}</td>
                <td style="color: var(--blue-primary); font-weight: 500;">${themes[s] || 'TECH'}</td>
                <td>${getSignal(change)}</td>
                <td class="right font-bold">${p?.currentPrice?.toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${change.toFixed(2)}%</td>
                <td class="right" style="color: var(--text-muted);">${p?.marketCap || '--'}</td>
                <td class="right">${p?.PE?.toFixed(1) || '--'}</td>
                <td class="right">${d.risk?.beta3Year?.toFixed(2) || '--'}</td>
            </tr>
        `;
    }).join('');
}

function renderBonds() {
    const yields = [
        {m: '1M', v: 4.52, h: 90}, {m: '3M', v: 4.42, h: 88}, {m: '6M', v: 4.38, h: 87},
        {m: '1Y', v: 4.22, h: 84}, {m: '2Y', v: 4.15, h: 83}, {m: '3Y', v: 4.18, h: 83},
        {m: '5Y', v: 4.25, h: 85}, {m: '7Y', v: 4.28, h: 86}, {m: '10Y', v: 4.32, h: 86},
        {m: '20Y', v: 4.48, h: 90}, {m: '30Y', v: 4.58, h: 92}
    ];

    document.getElementById('yieldCurve').innerHTML = yields.map(y => `
        <div class="yield-bar">
            <div class="yield-value">${y.v}%</div>
            <div class="yield-fill" style="height: ${y.h}%;"></div>
            <div class="yield-label">${y.m}</div>
        </div>
    `).join('');

    const forex = [
        {p: 'EUR/USD', r: 1.0845, c: 0.12}, {p: 'GBP/USD', r: 1.2645, c: -0.08},
        {p: 'USD/JPY', r: 149.85, c: 0.45}, {p: 'USD/CHF', r: 0.8945, c: 0.22},
        {p: 'AUD/USD', r: 0.6245, c: -0.35}, {p: 'USD/CAD', r: 1.4245, c: 0.15}
    ];
    
    document.getElementById('forexGrid').innerHTML = forex.map(f => {
        const isUp = f.c >= 0;
        return `
            <div class="mini-card center" onclick="searchTicker('${f.p.replace('/', '')}')">
                <div style="color: var(--blue-primary); font-weight: 600; margin-bottom: 8px;">${f.p}</div>
                <div class="text-xl font-bold mb-2" style="font-family: 'JetBrains Mono', monospace;">${f.r.toFixed(4)}</div>
                <div class="${isUp ? 'change-up' : 'change-down'} font-semibold">${isUp ? '+' : ''}${f.c}%</div>
            </div>
        `;
    }).join('');

    const rates = [
        {c: 'USA', cb: 'Fed', r: '4.25-4.50%', ch: '0.00', n: 'Mar 19', y10: '4.32%'},
        {c: 'EUROZONE', cb: 'ECB', r: '2.90%', ch: '0.00', n: 'Mar 06', y10: '2.45%'},
        {c: 'UK', cb: 'BoE', r: '4.50%', ch: '-0.25', n: 'Mar 20', y10: '4.52%'},
        {c: 'JAPAN', cb: 'BoJ', r: '0.50%', ch: '+0.25', n: 'Mar 19', y10: '1.35%'},
        {c: 'CANADA', cb: 'BoC', r: '3.00%', ch: '-0.25', n: 'Mar 12', y10: '3.22%'},
        {c: 'AUSTRALIA', cb: 'RBA', r: '4.10%', ch: '-0.25', n: 'Feb 18', y10: '4.45%'}
    ];
    
    document.getElementById('ratesTableBody').innerHTML = rates.map(r => `
        <tr>
            <td class="font-semibold">${r.c}</td>
            <td style="color: var(--text-muted);">${r.cb}</td>
            <td class="right" style="color: var(--blue-primary); font-weight: 600;">${r.r}</td>
            <td class="right ${r.ch.includes('+') ? 'change-up' : r.ch.includes('-') ? 'change-down' : ''}">${r.ch}</td>
            <td style="color: var(--blue-primary);">${r.n}</td>
            <td class="right">${r.y10}</td>
        </tr>
    `).join('');
}

function renderCrypto() {
    const cryptos = [
        {r: 1, n: 'Bitcoin', s: 'BTC', p: 67963.04, c24: -1.15, c7: -2.4, m: '1.35T'},
        {r: 2, n: 'Ethereum', s: 'ETH', p: 2034.63, c24: -1.79, c7: -5.2, m: '245.6B'},
        {r: 3, n: 'Tether', s: 'USDT', p: 1.00, c24: 0.00, c7: 0.01, m: '183.6B'},
        {r: 4, n: 'BNB', s: 'BNB', p: 629.92, c24: 0.17, c7: 2.5, m: '85.9B'},
        {r: 5, n: 'XRP', s: 'XRP', p: 1.41, c24: -3.24, c7: -8.5, m: '85.7B'},
        {r: 6, n: 'USDC', s: 'USDC', p: 1.00, c24: -0.02, c7: 0.00, m: '75.3B'},
        {r: 7, n: 'Solana', s: 'SOL', p: 86.99, c24: -1.00, c7: -12.5, m: '49.5B'},
        {r: 8, n: 'TRON', s: 'TRX', p: 0.28, c24: -0.70, c7: 5.2, m: '27.0B'},
        {r: 9, n: 'Dogecoin', s: 'DOGE', p: 0.098, c24: -1.96, c7: -15.2, m: '16.7B'},
        {r: 10, n: 'Cardano', s: 'ADA', p: 0.29, c24: -1.40, c7: -8.8, m: '10.6B'}
    ];
    
    document.getElementById('cryptoTableBody').innerHTML = cryptos.map(c => {
        const isUp24 = c.c24 >= 0;
        const isUp7 = c.c7 >= 0;
        return `
            <tr onclick="searchTicker('${c.s}')">
                <td style="color: var(--blue-primary); font-weight: 700;">${c.r}</td>
                <td class="font-semibold">${c.n}</td>
                <td style="color: var(--blue-primary); font-weight: 600;">${c.s}</td>
                <td class="right font-bold" style="font-family: 'JetBrains Mono', monospace;">${c.p.toLocaleString()}</td>
                <td class="right ${isUp24 ? 'change-up' : 'change-down'} font-semibold">${isUp24 ? '+' : ''}${c.c24}%</td>
                <td class="right ${isUp7 ? 'change-up' : 'change-down'} font-semibold">${isUp7 ? '+' : ''}${c.c7}%</td>
                <td class="right" style="color: var(--text-muted);">${c.m}</td>
            </tr>
        `;
    }).join('');
}

function renderETFs() {
    const etfFamilies = [
        {name: 'ARK Invest', theme: 'Disruptive Innovation', etfs: [{t: 'ARKK', n: 'Innovation'}, {t: 'ARKQ', n: 'Robotics'}, {t: 'ARKW', n: 'Web3'}, {t: 'ARKG', n: 'Genomics'}, {t: 'ARKF', n: 'Fintech'}]},
        {name: 'Vanguard', theme: 'Core Index', etfs: [{t: 'VOO', n: 'S&P 500'}, {t: 'VTI', n: 'Total Market'}, {t: 'VEA', n: 'Developed'}, {t: 'VWO', n: 'Emerging'}, {t: 'BND', n: 'Bonds'}]},
        {name: 'iShares', theme: 'Sector & Style', etfs: [{t: 'IVV', n: 'S&P 500'}, {t: 'IWM', n: 'Russell 2000'}, {t: 'EFA', n: 'EAFE'}, {t: 'AGG', n: 'Bonds'}, {t: 'IEMG', n: 'EM'}]},
        {name: 'Technology', theme: 'Semiconductors', etfs: [{t: 'SMH', n: 'Semiconductors'}, {t: 'BOTZ', n: 'Robotics'}, {t: 'CLOU', n: 'Cloud'}, {t: 'CIBR', n: 'Cybersec'}, {t: 'FINX', n: 'Fintech'}]},
        {name: 'Clean Energy', theme: 'Sustainability', etfs: [{t: 'ICLN', n: 'Global Clean'}, {t: 'LIT', n: 'Lithium'}, {t: 'TAN', n: 'Solar'}, {t: 'FAN', n: 'Wind'}, {t: 'PBW', n: 'WilderHill'}]}
    ];

    document.getElementById('thematicEtfFamilies').innerHTML = etfFamilies.map(family => {
        const etfRows = family.etfs.map(e => {
            const d = state.data[e.t];
            const change = d ? parseFloat(d.main_info?.oneDayChange) || 0 : (Math.random() * 4 - 2);
            const isUp = change >= 0;
            const price = d ? d.main_info?.currentPrice?.toFixed(2) : (Math.random() * 100 + 50).toFixed(2);
            
            return `
                <div class="etf-row" onclick="searchTicker('${e.t}')">
                    <div class="flex items-center gap-2">
                        <span class="ticker-badge" style="font-size: 10px;">${e.t}</span>
                        <span style="color: var(--text-muted); font-size: 11px;">${e.n}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-bold" style="font-family: 'JetBrains Mono', monospace;">${price}</span>
                        <span class="${isUp ? 'change-up' : 'change-down'}" style="font-size: 11px;">${isUp ? '+' : ''}${change.toFixed(2)}%</span>
                    </div>
                </div>
            `;
        }).join('');

        return `
            <div class="etf-family-card">
                <div class="etf-family-header">
                    <div class="etf-family-name">${family.name}</div>
                    <div class="etf-family-theme">${family.theme}</div>
                </div>
                <div class="etf-family-list">
                    ${etfRows}
                </div>
            </div>
        `;
    }).join('');

    const allEtfs = etfFamilies.flatMap(f => f.etfs.map(e => e.t));
    document.getElementById('etfDetailTable').innerHTML = allEtfs.map(t => {
        const d = state.data[t];
        if (!d) return '';
        const change = parseFloat(d.main_info?.oneDayChange) || 0;
        const isUp = change >= 0;
        const p = d.main_info;
        const family = etfFamilies.find(f => f.etfs.some(e => e.t === t));
        
        return `
            <tr onclick="searchTicker('${t}')">
                <td><span class="ticker-badge">${t}</span></td>
                <td>${family?.theme || 'THEMATIC'}</td>
                <td>${getSignal(change)}</td>
                <td class="right font-bold">${p?.currentPrice?.toFixed(2)}</td>
                <td class="right ${isUp ? 'change-up' : 'change-down'}">${isUp ? '+' : ''}${change.toFixed(2)}%</td>
                <td class="right" style="color: var(--text-muted);">${d.valuation?.marketCap || '--'}</td>
                <td class="right" style="color: var(--text-muted);">${d.dividends?.trailingAnnualDividendYield ? (d.dividends.trailingAnnualDividendYield * 100).toFixed(2) + '%' : '--'}</td>
                <td class="right">${d.risk?.beta3Year?.toFixed(2) || '--'}</td>
            </tr>
        `;
    }).join('');
}

function loadCharts() {
    ['chartSPY', 'chartQQQ', 'chartDIA'].forEach((id, i) => {
        const symbols = ['AMEX:SPY', 'NASDAQ:QQQ', 'AMEX:DIA'];
        loadTradingView(id, symbols[i]);
    });
}

function loadTradingView(containerId, symbol) {
    const container = document.getElementById(containerId);
    if (!container) return;
    container.innerHTML = '';
    
    const script = document.createElement('script');
    script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js';
    script.innerHTML = JSON.stringify({
        symbol: symbol,
        width: '100%',
        height: '100%',
        locale: 'en',
        dateRange: '1D',
        colorTheme: 'dark',
        trendLineColor: '#58a6ff',
        underLineColor: 'rgba(88, 166, 255, 0.1)',
        isTransparent: true,
        autosize: true
    });
    
    const div = document.createElement('div');
    div.className = 'tradingview-widget-container';
    div.style.width = '100%';
    div.style.height = '100%';
    div.appendChild(script);
    container.appendChild(div);
}

function formatVolume(num) {
    if (!num) return '--';
    if (num >= 1e9) return (num/1e9).toFixed(2) + 'B';
    if (num >= 1e6) return (num/1e6).toFixed(2) + 'M';
    if (num >= 1e3) return (num/1e3).toFixed(2) + 'K';
    return num.toString();
}

function switchView(view) {
    document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    document.getElementById(`view-${view}`).classList.add('active');
    event.target.classList.add('active');
    state.currentView = view;
    
    if (view === 'outlook') setTimeout(loadCharts, 100);
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeTickerDetail();
});

init();
</script>

</body>
</html>
